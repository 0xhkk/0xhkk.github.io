---
layout: post
title: "ä¸€æ–‡ææ‡‚ SPL Token"
---
# ä¸€æ–‡ææ‡‚ SPL Token

---

## 30 ç§’é€Ÿè§ˆ

```
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                                                     
     ğŸ­ Mint              ğŸ“¦ Token Account         ğŸªª Metadata        
     ä»£å¸çš„æ¨¡æ¿            ä½ çš„é’±åŒ…                  ä»£å¸çš„èº«ä»½è¯       
     â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       
     "USDC æ˜¯ä»€ä¹ˆ"         "ä½ æœ‰å¤šå°‘ USDC"          "USDC å«ä»€ä¹ˆåå­—"  
                                                                      
     82 å­—èŠ‚               165 å­—èŠ‚ï¼ˆSPL Token v1ï¼‰  å¤§å°å¯å˜ï¼ˆå¸¸è§å‡ ç™¾å­—èŠ‚èµ·ï¼‰
     æ¯ç§ä»£å¸ 1 ä¸ª          æ¯äººæ¯å¸ 1 ä¸ª            æ¯ç§ä»£å¸ 1 ä¸ª      
                                                                      
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

**ä¸‰å¥è¯æ€»ç»“ï¼š**
1. **Mint** = ä»£å¸çš„"å‡ºç”Ÿè¯æ˜"ï¼Œå®šä¹‰ç²¾åº¦å’Œæ€»é‡
2. **Token Account** = ç”¨æˆ·çš„"ä»£å¸é’±åŒ…"ï¼Œè®°å½•æŒæœ‰æ•°é‡
3. **Metadata** = ä»£å¸çš„"åç‰‡"ï¼Œå­˜å‚¨åç§°ã€å›¾ç‰‡ç­‰ä¿¡æ¯

---

## ä¸€ã€Mintï¼šä»£å¸çš„æ¨¡æ¿

### æ˜¯ä»€ä¹ˆï¼Ÿ

> **ç±»æ¯”ï¼šMint å°±åƒã€Œå°é’å‚çš„æ¨¡æ¿ã€**
> 
> å®ƒå®šä¹‰äº†ï¼šè¿™æ˜¯ä»€ä¹ˆå¸ï¼Ÿç²¾åº¦å¤šå°‘ï¼Ÿè°èƒ½å°ï¼Ÿâ€”â€”ä½†å®ƒæœ¬èº«ä¸å­˜é’±ã€‚

**ä¸€å¥è¯ï¼š** Mint æ˜¯ä»£å¸çš„å®šä¹‰ï¼Œæ¯ç§ä»£å¸æœ‰ä¸”åªæœ‰ä¸€ä¸ª Mintã€‚

### æ ¸å¿ƒå­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `decimals` | u8 | å°æ•°ä½æ•°ï¼ˆUSDC=6ï¼›SOL æ˜¯åŸç”Ÿå¸é SPL Tokenï¼Œè¿™é‡Œç”¨ 9 ä»…ä½œç±»æ¯”ï¼‰ |
| `supply` | u64 | å½“å‰æ€»ä¾›åº”é‡ |
| `mint_authority` | Option | è°èƒ½é“¸é€ æ–°å¸ï¼ˆNone=å›ºå®šä¾›åº”ï¼‰ |
| `freeze_authority` | Option | è°èƒ½å†»ç»“è´¦æˆ· |

### ä»£ç éª¨æ¶

```rust
pub struct Mint {
    pub mint_authority: COption<Pubkey>,   // é“¸å¸æƒé™
    pub supply: u64,                        // æ€»ä¾›åº”é‡
    pub decimals: u8,                       // å°æ•°ä½æ•°
    pub is_initialized: bool,               // æ˜¯å¦å·²åˆå§‹åŒ–
    pub freeze_authority: COption<Pubkey>, // å†»ç»“æƒé™
}
// æ€»å¤§å°ï¼š82 å­—èŠ‚
```

### `is_initialized` çŠ¶æ€è¯´æ˜

Mint è´¦æˆ·çš„ `is_initialized` æ˜¯ä¸€ä¸ª**é˜²æ­¢é‡å¤åˆå§‹åŒ–**çš„æ ‡å¿—ï¼š

| å€¼ | çŠ¶æ€ | è¯´æ˜ |
|----|------|------|
| `false` | æœªåˆå§‹åŒ– | è´¦æˆ·åˆšåˆ›å»ºï¼Œè¿˜æ²¡è°ƒç”¨ `InitializeMint` |
| `true` | å·²åˆå§‹åŒ– | æ­£å¸¸å¯ç”¨çŠ¶æ€ï¼Œä¸èƒ½å†æ¬¡åˆå§‹åŒ– |

```
è´¦æˆ·ç”Ÿå‘½å‘¨æœŸï¼š

åˆ›å»ºè´¦æˆ·              è°ƒç”¨ InitializeMint           æ­£å¸¸ä½¿ç”¨
    â”‚                        â”‚                         â”‚
    â–¼                        â–¼                         â–¼
 ç©ºè´¦æˆ·      â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    is_init     â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    å¯é“¸é€ 
(82 bytes)                = true                    å¯è½¬è´¦
```

> **å®‰å…¨æ„ä¹‰**ï¼šé˜²æ­¢æ”»å‡»è€…å¯¹å·²å­˜åœ¨çš„ Mint é‡æ–°åˆå§‹åŒ–ï¼Œç¯¡æ”¹ `mint_authority`ã€‚

### å¸¸è§é—®é¢˜

<details>
<summary><b>Q: decimals = 9 æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</b></summary>

è¡¨ç¤º 1 ä¸ªä»£å¸ = 10^9 ä¸ªæœ€å°å•ä½ã€‚ï¼ˆSOL çš„ 9 ä½å°æ•°æ˜¯ lamports çš„ç±»æ¯”ï¼›SOL æœ¬èº«ä¸æ˜¯ SPL Tokenï¼‰

```
ç”¨æˆ·çœ‹åˆ°ï¼š1.5 SOL
é“¾ä¸Šå­˜å‚¨ï¼š1_500_000_000ï¼ˆ15 äº¿ä¸ª lamportï¼‰
```

è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼šé“¾ä¸Šåªå­˜æ•´æ•°ï¼Œé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ã€‚
</details>

<details>
<summary><b>Q: å¦‚ä½•åˆ›å»ºå›ºå®šä¾›åº”é‡çš„ä»£å¸ï¼Ÿ</b></summary>

é“¸é€ å®Œæˆåï¼Œå°† `mint_authority` è®¾ä¸º `None`ï¼š

```rust
mint.mint_authority = COption::None;  // å†ä¹Ÿæ— æ³•é“¸é€ æ–°å¸
```
</details>


---

## äºŒã€Token Accountï¼šä½ çš„é’±åŒ…

### æ˜¯ä»€ä¹ˆï¼Ÿ

> **ç±»æ¯”ï¼šToken Account å°±åƒã€Œé“¶è¡Œè´¦æˆ·ã€**
> 
> Mint æ˜¯"ç¾å…ƒçš„å®šä¹‰"ï¼ŒToken Account æ˜¯"ä½ åœ¨æŸé“¶è¡Œå¼€çš„ç¾å…ƒè´¦æˆ·"ã€‚

**ä¸€å¥è¯ï¼š** Token Account å­˜å‚¨æŸäººæŒæœ‰æŸç§ä»£å¸çš„æ•°é‡ã€‚

### æ ¸å¿ƒå­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `mint` | Pubkey | è¿™æ˜¯ä»€ä¹ˆä»£å¸ |
| `owner` | Pubkey | è°æ‹¥æœ‰è¿™ä¸ªè´¦æˆ· |
| `amount` | u64 | ä½™é¢ |
| `state` | enum | æ­£å¸¸/å†»ç»“/æœªåˆå§‹åŒ– |
| `delegate` | Option | æˆæƒç»™è°æ“ä½œ |

### ä»£ç éª¨æ¶

```rust
pub struct Account {
    pub mint: Pubkey,                      // å…³è”çš„ Mint
    pub owner: Pubkey,                     // æ‰€æœ‰è€…
    pub amount: u64,                       // ä½™é¢
    pub delegate: COption<Pubkey>,         // ä»£ç†
    pub state: AccountState,               // çŠ¶æ€ï¼ˆè§ä¸‹æ–¹è¯´æ˜ï¼‰
    pub is_native: COption<u64>,           // æ˜¯å¦æ˜¯ Wrapped SOL
    pub delegated_amount: u64,             // ä»£ç†é¢åº¦
    pub close_authority: COption<Pubkey>,  // å…³é—­æƒé™
}
// Total size: 165 bytes (SPL Token v1). Token-2022 accounts can be larger due to extensions.
```

### `AccountState` çŠ¶æ€è¯´æ˜

Token Account çš„ `state` å­—æ®µæœ‰**ä¸‰ç§çŠ¶æ€**ï¼š

```rust
pub enum AccountState {
    Uninitialized = 0,  // æœªåˆå§‹åŒ–
    Initialized = 1,    // æ­£å¸¸å¯ç”¨
    Frozen = 2,         // å·²å†»ç»“
}
```

| å€¼ | çŠ¶æ€ | è¯´æ˜ | èƒ½åšä»€ä¹ˆ |
|----|------|------|---------|
| `0` | **Uninitialized** | è´¦æˆ·åˆšåˆ›å»ºï¼Œæœªåˆå§‹åŒ– | âŒ ä¸èƒ½æ“ä½œ |
| `1` | **Initialized** | æ­£å¸¸å¯ç”¨çŠ¶æ€ | âœ… è½¬è´¦ã€æ¥æ”¶ã€å…³é—­ |
| `2` | **Frozen** | è¢« `freeze_authority` å†»ç»“ | âŒ ä¸èƒ½è½¬è´¦ï¼Œä½†èƒ½æ¥æ”¶ |

```
Token Account ç”Ÿå‘½å‘¨æœŸï¼š

åˆ›å»ºè´¦æˆ·        InitializeAccount       æ­£å¸¸ä½¿ç”¨          FreezeAccount
    â”‚                  â”‚                   â”‚                   â”‚
    â–¼                  â–¼                   â–¼                   â–¼
Uninitialized â”€â”€â–º Initialized â—„â”€â”€â”€â”€â–º è½¬è´¦ä¸­/æ¥æ”¶ä¸­ â”€â”€â”€â”€â–º Frozen (2)
    (0)              (1)                                      â”‚
                                                        ThawAccount
                                                              â”‚
                                                              â–¼
                                                       å›åˆ° Initialized
```

> **Frozen çŠ¶æ€çš„ç”¨é€”**ï¼š
> - åˆè§„åœºæ™¯ï¼šå†»ç»“å¯ç–‘è´¦æˆ·ï¼ˆå¦‚ USDC çš„å‘è¡Œæ–¹å¯ä»¥å†»ç»“è¿è§„åœ°å€ï¼‰
> - å®‰å…¨åœºæ™¯ï¼šå‘ç°è¢«ç›—åç«‹å³å†»ç»“ï¼Œé˜²æ­¢èµ„äº§è½¬ç§»
>

### ATAï¼šä½ æœ€å¸¸ç”¨çš„ Token Account

**ATAï¼ˆAssociated Token Accountï¼‰** æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Token Accountï¼Œåœ°å€å¯ä»¥æ ¹æ®å…¬å¼è®¡ç®—å‡ºæ¥ï¼š

```
ATA åœ°å€ = PDA([é’±åŒ…åœ°å€, Tokenç¨‹åºID, Mintåœ°å€], Associated Token Program ID)
```

å…¶ä¸­ `Tokenç¨‹åºID` æŒ‡çš„æ˜¯ Token Programï¼ˆ`TOKEN_PROGRAM_ID` æˆ– `TOKEN_2022_PROGRAM_ID`ï¼‰ï¼Œä¸åŒ Token Program ä¼šå¯¼å‡ºä¸åŒçš„ ATA åœ°å€ã€‚

**å¥½å¤„ï¼š** ä¸éœ€è¦å‘Šè¯‰åˆ«äºº Token Account åœ°å€ï¼Œå¯ä»¥è‡ªå·±ç®—å‡ºæ¥

> **æ³¨æ„**ï¼šç®—å¾—å‡º ATA åœ°å€ â‰  é“¾ä¸Šå·²ç»å­˜åœ¨è¿™ä¸ªè´¦æˆ·ã€‚æ²¡åˆ›å»ºå‰é“¾ä¸Šä¸ä¼šæœ‰ä½™é¢è®°å½•ï¼Œéœ€è¦å…ˆåˆ›å»º ATAï¼ˆæˆ–ç”¨â€œå¹‚ç­‰åˆ›å»ºâ€é¿å…é‡å¤åˆ›å»ºå¤±è´¥ï¼‰ã€‚

```typescript
// Anyone can derive your USDC ATA address (inside an async function).
const yourUsdcAccount = await getAssociatedTokenAddress(
  USDC_MINT,          // Mint
  yourWallet,         // Owner (wallet)
  false,              // allowOwnerOffCurve
  TOKEN_PROGRAM_ID    // tokenProgramId (use TOKEN_2022_PROGRAM_ID for Token-2022)
);
```

### å¸¸è§é—®é¢˜

<details>
<summary><b>Q: ä¸ºä»€ä¹ˆè¦æœ‰ Token Accountï¼Ÿä¸èƒ½ç›´æ¥åœ¨é’±åŒ…é‡Œå­˜ä»£å¸å—ï¼Ÿ</b></summary>

Solana çš„è®¾è®¡ç†å¿µæ˜¯ã€Œè´¦æˆ·åˆ†ç¦»ã€ï¼š

- **é’±åŒ…åœ°å€**ï¼šåªæ˜¯ä¸€ä¸ªèº«ä»½ï¼ˆå…¬é’¥ï¼‰
- **Token Account**ï¼šçœŸæ­£å­˜ä»£å¸çš„åœ°æ–¹

å¥½å¤„æ˜¯ï¼šæ¯ä¸ªä»£å¸è´¦æˆ·å¯ä»¥æœ‰ç‹¬ç«‹çš„æƒé™æ§åˆ¶ã€‚
</details>

<details>
<summary><b>Q: Wrapped SOL æ˜¯ä»€ä¹ˆï¼Ÿ</b></summary>

åŸç”Ÿ SOL ä¸æ˜¯ SPL Tokenï¼Œä½†æœ‰æ—¶éœ€è¦æŠŠå®ƒå½“ Token ç”¨ï¼ˆæ¯”å¦‚åœ¨ DEX äº¤æ˜“ï¼‰ã€‚

Wrapped SOLï¼ˆWSOLï¼‰å¯ä»¥ç†è§£ä¸ºâ€œç”¨ Token Account æ¥è£… SOLâ€ï¼š
- è´¦æˆ·é‡ŒçœŸå®çš„ SOL ä½“ç°åœ¨ `lamports`ï¼Œå…¶ä¸­è¿˜åŒ…å«ä¸€éƒ¨åˆ†ä¸ºâ€œå…ç§Ÿâ€é¢„ç•™çš„ lamports
- `amount` ä»£è¡¨å¯ç”¨çš„ WSOL æ•°é‡ï¼Œé€šå¸¸éœ€è¦é€šè¿‡åŒæ­¥æŒ‡ä»¤æŠŠå®ƒå’Œ lamportsï¼ˆæ‰£æ‰å…ç§Ÿé¢„ç•™ï¼‰å¯¹é½
- å–å‡º SOLï¼ˆunwrapï¼‰é€šå¸¸æ˜¯å…³é—­è¯¥ Token Accountï¼ŒæŠŠ lamports é€€å›åˆ°é’±åŒ…åœ°å€

```
Native SOL Mint: So11111111111111111111111111111111111111112
```
</details>

<details>
<summary><b>Q: delegate æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</b></summary>

å…è®¸åˆ«äººä»£ä½ æ“ä½œä¸€å®šé¢åº¦çš„ä»£å¸ï¼Œå¸¸è§äºï¼š
- DEX æˆæƒï¼šå…è®¸ DEX æ‰£ä½ æœ€å¤š 100 USDC
- è®¢é˜…æœåŠ¡ï¼šå…è®¸æœåŠ¡å•†æ¯æœˆæ‰£æ¬¾

```rust
// æˆæƒå
account.delegate = Some(dex_address);
account.delegated_amount = 100_000_000;  // 100 USDC
```
</details>

---

## ä¸‰ã€Metadataï¼šä»£å¸çš„èº«ä»½è¯

### æ˜¯ä»€ä¹ˆï¼Ÿ

> **ç±»æ¯”ï¼šMetadata å°±åƒã€Œå•†å“æ ‡ç­¾ã€**
> 
> Mint åªæ˜¯ä¸€ä¸²ä»£ç ï¼ŒMetadata å‘Šè¯‰ä½ å®ƒå«ä»€ä¹ˆåå­—ã€é•¿ä»€ä¹ˆæ ·ã€‚

**ä¸€å¥è¯ï¼š** Metadata å­˜å‚¨ä»£å¸çš„åç§°ã€ç¬¦å·ã€å›¾ç‰‡ç­‰äººç±»å¯è¯»ä¿¡æ¯ã€‚

### æ ¸å¿ƒå­—æ®µï¼ˆFT å¸¸ç”¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `name` | String | ä»£å¸åç§°ï¼ˆæœ€é•¿ 32 å­—ç¬¦ï¼‰ |
| `symbol` | String | ä»£å¸ç¬¦å·ï¼ˆæœ€é•¿ 10 å­—ç¬¦ï¼‰ |
| `uri` | String | æŒ‡å‘ JSON çš„é“¾æ¥ï¼ˆlogo ç­‰ï¼‰ |
| `update_authority` | Pubkey | è°èƒ½ä¿®æ”¹ metadata |

### ä»£ç éª¨æ¶

```rust
pub struct Metadata {
    pub key: Key,                              // è´¦æˆ·ç±»å‹æ ‡è¯†ï¼ˆMetadataV1ï¼‰
    pub update_authority: Pubkey,              // æ›´æ–°æƒé™
    pub mint: Pubkey,                          // å…³è”çš„ Mint åœ°å€
    pub data: Data,                            // æ ¸å¿ƒæ•°æ®ï¼ˆname, symbol, uriï¼‰
    pub primary_sale_happened: bool,           // æ˜¯å¦å·²é¦–æ¬¡é”€å”®
    pub is_mutable: bool,                      // æ˜¯å¦å¯ä¿®æ”¹
    pub edition_nonce: Option<u8>,             // NFT ç”¨ï¼šEdition PDA bump
    pub token_standard: Option<TokenStandard>, // Fungible / NonFungible ç­‰
    pub collection: Option<Collection>,        // NFT ç”¨ï¼šæ‰€å±é›†åˆ
    pub uses: Option<Uses>,                    // NFT ç”¨ï¼šä½¿ç”¨æ¬¡æ•°
    pub collection_details: Option<CollectionDetails>, // NFT ç”¨ï¼šé›†åˆè¯¦æƒ…
    pub programmable_config: Option<ProgrammableConfig>, // pNFT ç”¨
}

/// æ ¸å¿ƒæ•°æ®
pub struct Data {
    pub name: String,                          // åç§°ï¼ˆæœ€é•¿ 32 å­—ç¬¦ï¼‰
    pub symbol: String,                        // ç¬¦å·ï¼ˆæœ€é•¿ 10 å­—ç¬¦ï¼‰
    pub uri: String,                           // JSON å…ƒæ•°æ®é“¾æ¥ï¼ˆæœ€é•¿ 200 å­—ç¬¦ï¼‰
    pub seller_fee_basis_points: u16,          // ç‰ˆç¨ï¼ˆFT é€šå¸¸ä¸º 0ï¼‰
    pub creators: Option<Vec<Creator>>,        // åˆ›ä½œè€…åˆ—è¡¨ï¼ˆFT é€šå¸¸ä¸º Noneï¼‰
}
```

> ğŸ’¡ **NFT ä¸“å±å­—æ®µ**ï¼ˆ`edition_nonce`, `collection`, `uses` ç­‰ï¼‰å¯¹äºæ™®é€š FT éƒ½æ˜¯ `None`ã€‚
 

### Metadata åœ°å€æ˜¯ PDA

```
Metadata åœ°å€ = PDA(["metadata", ç¨‹åºID, Mintåœ°å€])
```

```typescript
const [metadataPDA] = PublicKey.findProgramAddressSync(
  [
    Buffer.from("metadata"),
    METADATA_PROGRAM_ID.toBuffer(),
    mintAddress.toBuffer(),
  ],
  METADATA_PROGRAM_ID
);
```

### å¸¸è§é—®é¢˜

<details>
<summary><b>Q: å›¾ç‰‡å­˜åœ¨å“ªé‡Œï¼Ÿ</b></summary>

å›¾ç‰‡**ä¸å­˜åœ¨é“¾ä¸Š**`uri` å­—æ®µæŒ‡å‘ä¸€ä¸ª JSON æ–‡ä»¶ï¼ŒJSON é‡Œæœ‰å›¾ç‰‡é“¾æ¥ï¼š

```
é“¾ä¸Š Metadata
     â”‚
     â””â”€â–º uri: "https://arweave.net/xxx"
              â”‚
              â””â”€â–º JSON: { "image": "https://arweave.net/yyy.png" }
                              â”‚
                              â””â”€â–º å®é™…å›¾ç‰‡æ–‡ä»¶
```

å¸¸è§å­˜å‚¨æœåŠ¡ï¼šArweaveã€IPFSã€AWS S3
</details>

<details>
<summary><b>Q: seller_fee_basis_points æ˜¯ä»€ä¹ˆï¼Ÿ</b></summary>

äºŒçº§å¸‚åœºç‰ˆç¨ï¼Œå•ä½æ˜¯ã€ŒåŸºç‚¹ã€ï¼ˆä¸»è¦ç”¨äº NFTï¼‰ï¼š
- 100 = 1%
- 500 = 5%
- 1000 = 10%

**æ™®é€š FT é€šå¸¸è®¾ä¸º 0**ï¼ˆæ²¡æœ‰ç‰ˆç¨ï¼‰ã€‚
</details>

<details>
<summary><b>Q: æ™®é€š FT éœ€è¦ Metadata å—ï¼Ÿ</b></summary>

**å¯é€‰ï¼Œä½†æ¨è**ã€‚æœ‰ Metadata åé’±åŒ…æ‰èƒ½æ˜¾ç¤ºä»£å¸çš„åå­—å’Œ logoã€‚

æ²¡æœ‰ Metadata çš„ä»£å¸åœ¨é’±åŒ…é‡Œåªæ˜¾ç¤ºåœ°å€ï¼Œç”¨æˆ·ä½“éªŒå·®ã€‚
</details>

---

## å››ã€ä¸‰è€…çš„å…³ç³»

### 4.1 ATA åœ°å€æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„ï¼Ÿ

> **æ ¸å¿ƒæ¦‚å¿µ**ï¼šATAï¼ˆAssociated Token Accountï¼‰çš„åœ°å€ä¸æ˜¯éšæœºç”Ÿæˆçš„ï¼Œ
> è€Œæ˜¯ç”± **3 ä¸ªè¾“å…¥** é€šè¿‡ PDA å…¬å¼**ç¡®å®šæ€§è®¡ç®—**å‡ºæ¥çš„ã€‚

<img src="/assets/spltoken/ata.png" alt="ATA åœ°å€æ¨å¯¼ç¤ºæ„å›¾" width="650">


**å…³é”®ç†è§£**ï¼š
- åŒä¸€ä¸ª Wallet + åŒä¸€ä¸ª Mint = **æ°¸è¿œå¾—åˆ°åŒä¸€ä¸ª ATA åœ°å€**
- ä¸åŒ Token Programï¼ˆSPL Token vs Token-2022ï¼‰= **ä¸åŒçš„ ATA åœ°å€**
- ATA åœ°å€æ˜¯**è®¡ç®—å‡ºæ¥çš„**ï¼Œä½†â€œåœ°å€å¯è®¡ç®—â€ä¸ä»£è¡¨â€œè´¦æˆ·å·²å­˜åœ¨â€ï¼ˆä¸å­˜åœ¨å°±éœ€è¦å…ˆåˆ›å»ºï¼‰

### 4.2 å®Œæ•´å…³ç³»å›¾

![Mint / Token Account / Metadata å®Œæ•´å…³ç³»å›¾](/assets/spltoken/å…³ç³»å›¾.png)

### 4.3 å…³ç³»æ€»ç»“

| å…³ç³» | é€šä¿—è§£é‡Š |
|------|---------|
| **Wallet â†’ ATA** | é’±åŒ… + ä»£å¸ç±»å‹ â†’ ç®—å‡ºä½ çš„ä»£å¸è´¦æˆ·åœ°å€ |
| **ATA â†’ Mint** | æ¯ä¸ª ATA éƒ½çŸ¥é“"æˆ‘å­˜çš„æ˜¯ä»€ä¹ˆå¸" |
| **Mint â†’ Metadata** | ä»£å¸åœ°å€ â†’ ç®—å‡ºå®ƒçš„åç‰‡åœ¨å“ª |
| **Metadata â†’ JSON** | åç‰‡é‡Œæœ‰ä¸ªé“¾æ¥ï¼ŒæŒ‡å‘å›¾ç‰‡å’Œè¯¦ç»†ä¿¡æ¯ |

**ä¸€å¥è¯æ€»ç»“**ï¼š
> ATA åœ°å€ = **é’±åŒ… + ä»£å¸ç±»å‹** çš„å”¯ä¸€ç»„åˆï¼Œä»»ä½•äººéƒ½èƒ½ç®—å‡ºæ¥ï¼Œä¸ç”¨æŸ¥é“¾ã€‚
    
- Metadata â”€â”€uriå­—æ®µâ”€â”€â–º JSON â”€â”€â–º å›¾ç‰‡ï¼ˆå›¾ç‰‡å­˜å‚¨åœ¨é“¾ä¸‹ï¼šArweave/IPFSï¼‰

---

## äº”ã€å®æˆ˜ï¼šåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªä»£å¸

### å®Œæ•´æµç¨‹ï¼ˆ5 æ­¥ï¼‰

```typescript
import {
  Connection,
  Keypair,
  PublicKey,
  SystemProgram,
  Transaction,
  sendAndConfirmTransaction,
  clusterApiUrl,
  LAMPORTS_PER_SOL,
} from "@solana/web3.js";
import * as fs from "fs";
import * as path from "path";
import {
  TOKEN_PROGRAM_ID,
  createInitializeMintInstruction,
  createAssociatedTokenAccountInstruction,
  createMintToInstruction,
  getAssociatedTokenAddress,
  MINT_SIZE,
} from "@solana/spl-token";
import {
  PROGRAM_ID as METADATA_PROGRAM_ID,
  createCreateMetadataAccountV3Instruction,
} from "@metaplex-foundation/mpl-token-metadata";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é…ç½®åŒºåŸŸ - æ ¹æ®éœ€è¦ä¿®æ”¹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ä½¿ç”¨ devnetï¼ˆæµ‹è¯•ç½‘ï¼‰
const NETWORK = "devnet";

// ä»£å¸é…ç½®
const TOKEN_CONFIG = {
  name: "My Token",
  symbol: "MTK",
  decimals: 9,
  uri: "https://example.com/token.json", // å¯ä»¥æ›¿æ¢ä¸ºä½ çš„ JSON å…ƒæ•°æ® URL
  mintAmount: 1_000_000_000, // 1 token (å› ä¸º decimals = 9)
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ä¸»å‡½æ•°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function main() {
  console.log("ğŸš€ å¼€å§‹åˆ›å»ºä»£å¸...\n");

  // 1. å»ºç«‹è¿æ¥
  const connection = new Connection(clusterApiUrl(NETWORK), "confirmed");
  console.log(`ğŸ“¡ å·²è¿æ¥åˆ° ${NETWORK}`);

  // 2. åŠ è½½æˆ–åˆ›å»ºé’±åŒ…
  let payer: Keypair;
  
  // å°è¯•ä»æœ¬åœ°é’±åŒ…æ–‡ä»¶åŠ è½½
// NOTE: This example assumes a CommonJS runtime where __dirname exists.
// If you run it in ESM ("type": "module"), replace __dirname with an ESM-safe approach.
  const localWalletPath = path.join(__dirname, "test.json");
  
  if (fs.existsSync(localWalletPath)) {
    // ä½¿ç”¨æœ¬åœ°å·²æœ‰é’±åŒ…ï¼ˆæ¨èï¼Œé€šå¸¸å·²æœ‰ SOLï¼‰
    const secretKey = JSON.parse(fs.readFileSync(localWalletPath, "utf-8"));
    payer = Keypair.fromSecretKey(Uint8Array.from(secretKey));
    console.log(`ğŸ‘› ä½¿ç”¨æœ¬åœ°é’±åŒ…: ${payer.publicKey.toBase58()}`);
    console.log(`   (æ¥è‡ª ${localWalletPath})`);
  } else {
    // ç”Ÿæˆæ–°çš„ä¸´æ—¶é’±åŒ…ï¼ˆéœ€è¦ç©ºæŠ•ï¼‰
    payer = Keypair.generate();
    console.log(`ğŸ‘› ç”Ÿæˆæ–°é’±åŒ…: ${payer.publicKey.toBase58()}`);
    // WARNING: Never print or share secret keys in real projects.
    console.log(`ğŸ”‘ å·²ç”Ÿæˆæ–°é’±åŒ…ï¼ˆç§é’¥è¾“å‡ºå·²çœç•¥ï¼Œè¯·è‡ªè¡Œå®‰å…¨ä¿å­˜ï¼‰`);
  }


  // 3. æ£€æŸ¥ä½™é¢
  const balance = await connection.getBalance(payer.publicKey);
  console.log(`ğŸ’µ ä½™é¢: ${balance / LAMPORTS_PER_SOL} SOL\n`);

  // 4. åˆ›å»ºä»£å¸
  await createToken(connection, payer);
}

async function createToken(connection: Connection, payer: Keypair) {
  // ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ä½œä¸º payerã€authority å’Œ userï¼ˆç®€åŒ–æµ‹è¯•ï¼‰
  const authority = payer;
  const user = payer;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Step 1: åˆ›å»º Mint è´¦æˆ·
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  console.log("ğŸ“ Step 1: åˆ›å»º Mint è´¦æˆ·...");
  const mint = Keypair.generate();
  console.log(`   Mint åœ°å€: ${mint.publicKey.toBase58()}`);
  // WARNING: Never print or share secret keys in real projects.
  console.log(`   Mint ç§é’¥: [omitted]`);

  const lamports = await connection.getMinimumBalanceForRentExemption(MINT_SIZE);

  const createMintAccountIx = SystemProgram.createAccount({
    fromPubkey: payer.publicKey,
    newAccountPubkey: mint.publicKey,
    lamports,
    space: MINT_SIZE,
    programId: TOKEN_PROGRAM_ID,
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Step 2: åˆå§‹åŒ– Mint
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  console.log("ğŸ“ Step 2: åˆå§‹åŒ– Mint...");
  const initMintIx = createInitializeMintInstruction(
    mint.publicKey,
    TOKEN_CONFIG.decimals,
    authority.publicKey,
    authority.publicKey // freeze authority (å¯é€‰ï¼Œè®¾ä¸º null åˆ™æ— æ³•å†»ç»“)
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Step 3: åˆ›å»º Metadata
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  console.log("ğŸ“ Step 3: åˆ›å»º Metadata...");
  const [metadataPDA] = PublicKey.findProgramAddressSync(
    [
      Buffer.from("metadata"),
      METADATA_PROGRAM_ID.toBuffer(),
      mint.publicKey.toBuffer(),
    ],
    METADATA_PROGRAM_ID
  );
  console.log(`   Metadata PDA: ${metadataPDA.toBase58()}`);

  const createMetadataIx = createCreateMetadataAccountV3Instruction(
    {
      metadata: metadataPDA,
      mint: mint.publicKey,
      mintAuthority: authority.publicKey,
      payer: payer.publicKey,
      updateAuthority: authority.publicKey,
    },
    {
      createMetadataAccountArgsV3: {
        data: {
          name: TOKEN_CONFIG.name,
          symbol: TOKEN_CONFIG.symbol,
          uri: TOKEN_CONFIG.uri,
          sellerFeeBasisPoints: 0,
          creators: null,
          collection: null,
          uses: null,
        },
        isMutable: true,
        collectionDetails: null,
      },
    }
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Step 4: åˆ›å»º Token Account (ATA)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  console.log("ğŸ“ Step 4: åˆ›å»º Token Account (ATA)...");
  const ata = await getAssociatedTokenAddress(mint.publicKey, user.publicKey);
  console.log(`   ATA åœ°å€: ${ata.toBase58()}`);

  const createAtaIx = createAssociatedTokenAccountInstruction(
    payer.publicKey,
    ata,
    user.publicKey,
    mint.publicKey
  );
  // NOTE: If the ATA already exists, use the idempotent instruction instead.

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // Step 5: é“¸é€ ä»£å¸
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  console.log("ğŸ“ Step 5: é“¸é€ ä»£å¸...");
  const mintToIx = createMintToInstruction(
    mint.publicKey,
    ata,
    authority.publicKey,
    TOKEN_CONFIG.mintAmount
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // å‘é€äº¤æ˜“
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  console.log("\nğŸ“¤ å‘é€äº¤æ˜“...");
  const tx = new Transaction().add(
    createMintAccountIx,
    initMintIx,
    createMetadataIx,
    createAtaIx,
    mintToIx
  );

  try {
    const signature = await sendAndConfirmTransaction(connection, tx, [
      payer,
      mint,
    ]);

    console.log("\n" + "â•".repeat(60));
    console.log("âœ… ä»£å¸åˆ›å»ºæˆåŠŸ!");
    console.log("â•".repeat(60));
    console.log(`   ä»£å¸åç§°: ${TOKEN_CONFIG.name}`);
    console.log(`   ä»£å¸ç¬¦å·: ${TOKEN_CONFIG.symbol}`);
    console.log(`   å°æ•°ä½æ•°: ${TOKEN_CONFIG.decimals}`);
    console.log(`   Mint åœ°å€: ${mint.publicKey.toBase58()}`);
    console.log(`   Metadata: ${metadataPDA.toBase58()}`);
    console.log(`   ä½ çš„ ATA: ${ata.toBase58()}`);
    // NOTE: For large amounts, avoid JS number precision issues (use bigint/BN in real projects).
    console.log(`   é“¸é€ æ•°é‡: ${TOKEN_CONFIG.mintAmount / 10 ** TOKEN_CONFIG.decimals} ${TOKEN_CONFIG.symbol}`);
    console.log("â•".repeat(60));
    console.log(`\nğŸ”— åœ¨ Solana Explorer æŸ¥çœ‹:`);
    console.log(`   https://explorer.solana.com/address/${mint.publicKey.toBase58()}?cluster=${NETWORK}`);
    console.log(`\nğŸ“ äº¤æ˜“ç­¾å:`);
    console.log(`   https://explorer.solana.com/tx/${signature}?cluster=${NETWORK}`);
  } catch (error) {
    console.error("âŒ äº¤æ˜“å¤±è´¥:", error);
    throw error;
  }
}

// è¿è¡Œä¸»å‡½æ•°
main().catch(console.error);
```

> ğŸ’¡ **åˆ›å»º NFT**ï¼šNFT çš„åˆ›å»ºæµç¨‹æ›´å¤æ‚ï¼Œéœ€è¦é¢å¤–åˆ›å»º Master Editionã€‚
 

---

## å…­ã€åº•å±‚åŸç†ï¼šå®¢æˆ·ç«¯ä»£ç èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

ä¸Šé¢çš„ TypeScript ä»£ç è°ƒç”¨äº†å‡ ä¸ªæŒ‡ä»¤ï¼Œä½†å®ƒä»¬åœ¨é“¾ä¸Šå®é™…åšäº†ä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬ç»“åˆ SPL Token åˆçº¦æºç æ¥çœ‹ã€‚

### 6.1 æµç¨‹æ€»è§ˆ

![åˆ›å»ºä»£å¸çš„åº•å±‚æµç¨‹](/assets/spltoken/æµç¨‹æ€»è§ˆ.png)

### 6.2 Step 1: CreateAccountï¼ˆSystem Programï¼‰

**è¿™ä¸€æ­¥ä¸æ˜¯ SPL Token åšçš„ï¼Œæ˜¯ System Program**

```typescript
// å®¢æˆ·ç«¯ä»£ç 
SystemProgram.createAccount({
  fromPubkey: payer.publicKey,      // è°ä»˜é’±
  newAccountPubkey: mint.publicKey, // æ–°è´¦æˆ·åœ°å€
  lamports: rent,                   // ç§Ÿé‡‘ï¼ˆçº¦ 0.00145 SOLï¼‰
  space: 82,                        // åˆ†é… 82 å­—èŠ‚
  programId: TOKEN_PROGRAM_ID,      // owner è®¾ä¸º Token Program
});
```

**åº•å±‚åšäº†ä»€ä¹ˆï¼š**

| æ“ä½œ | è¯´æ˜ |
|------|------|
| æ‰£é™¤ lamports | ä» `payer` è½¬ç§»ç§Ÿé‡‘åˆ°æ–°è´¦æˆ· |
| åˆ†é…ç©ºé—´ | åˆ›å»º 82 å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ï¼ˆåˆå§‹å…¨ä¸º 0ï¼‰ |
| è®¾ç½® owner | å°†è´¦æˆ· owner è®¾ä¸º Token Program |

```
åˆ›å»ºåçš„è´¦æˆ·çŠ¶æ€ï¼š

Address: mint.publicKey
Owner: Token Program
Lamports: ~1,461,600 (ç§Ÿé‡‘)
Data: [0, 0, 0, 0, ... å…±82å­—èŠ‚å…¨0]   â† è¿˜æ²¡åˆå§‹åŒ–
```

### 6.3 Step 2: InitializeMintï¼ˆSPL Token Programï¼‰

```typescript
// å®¢æˆ·ç«¯ä»£ç 
createInitializeMintInstruction(
  mint.publicKey,           // mint åœ°å€
  9,                        // decimals
  authority.publicKey,      // mint authority
  authority.publicKey,      // freeze authority
);
```

**SPL Token åˆçº¦ä»£ç ï¼ˆç²¾ç®€ç‰ˆï¼‰ï¼š**

```rust
// æ¥æºï¼šspl-token/program/src/processor.rs

fn _process_initialize_mint(
    accounts: &[AccountInfo],
    decimals: u8,
    mint_authority: Pubkey,
    freeze_authority: COption<Pubkey>,
) -> ProgramResult {
    let mint_info = next_account_info(account_info_iter)?;
    
    // â‘  è¯»å–è´¦æˆ·æ•°æ®ï¼ˆ82å­—èŠ‚çš„0ï¼‰, è½¬æ¢æˆ Mint ç»“æ„ä½“
    let mut mint = Mint::unpack_unchecked(&mint_info.data.borrow())?;
    
    // â‘¡ æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡ï¼ˆé˜²æ­¢é‡å¤åˆå§‹åŒ–ï¼‰
    if mint.is_initialized {
        return Err(TokenError::AlreadyInUse.into());
    }

    // â‘¢ æ£€æŸ¥ç§Ÿé‡‘æ˜¯å¦è¶³å¤Ÿ
    if !rent.is_exempt(mint_info.lamports(), mint_data_len) {
        return Err(TokenError::NotRentExempt.into());
    }

    // â‘£ å¡«å…… Mint æ•°æ®ç»“æ„
    mint.mint_authority = COption::Some(mint_authority);  // è°èƒ½é“¸å¸
    mint.decimals = decimals;                              // ç²¾åº¦
    mint.is_initialized = true;                            // æ ‡è®°å·²åˆå§‹åŒ–
    mint.freeze_authority = freeze_authority;              // è°èƒ½å†»ç»“
    // supply ä¿æŒä¸º 0

    // â‘¤ åºåˆ—åŒ–å¹¶å†™å›è´¦æˆ·
    Mint::pack(mint, &mut mint_info.data.borrow_mut())?;

    Ok(())
}
```

**åˆå§‹åŒ–åçš„å†…å­˜å˜åŒ–ï¼š**

```
Before (å…¨0):
[00 00 00 00 00 00 00 00 00 00 ... 00 00 00 00]

After (ç»“æ„åŒ–æ•°æ®):

Offset   Data
------   ------------------------------------------
0-3      [01 00 00 00]              â† Some tag
4-35     [mint_authority å…¬é’¥]
36-43    [00 00 00 00 00 00 00 00]  â† supply = 0
44       [09]                       â† decimals=9
45       [01]                       â† initialized
46-81    [freeze_authority...]
```

### 6.4 Step 3: MintToï¼ˆSPL Token Programï¼‰

```typescript
// å®¢æˆ·ç«¯ä»£ç 
createMintToInstruction(
  mint.publicKey,       // mint
  ata,                  // ç›®æ ‡ Token Account
  authority.publicKey,  // mint authorityï¼ˆå¿…é¡»ç­¾åï¼‰
  1_000_000_000         // æ•°é‡
);
```

**SPL Token åˆçº¦ä»£ç ï¼ˆç²¾ç®€ç‰ˆï¼‰ï¼š**

```rust
// æ¥æºï¼šspl-token/program/src/processor.rs

pub fn process_mint_to(
    program_id: &Pubkey,
    accounts: &[AccountInfo],
    amount: u64,
) -> ProgramResult {
    let mint_info = next_account_info(account_info_iter)?;
    let destination_account_info = next_account_info(account_info_iter)?;
    let owner_info = next_account_info(account_info_iter)?;  // mint_authority

    // â‘  è¯»å–å¹¶éªŒè¯ Token Account
    let mut destination_account = Account::unpack(&destination_account_info.data.borrow())?;
    
    if destination_account.is_frozen() {
        return Err(TokenError::AccountFrozen.into());
    }
    if !cmp_pubkeys(mint_info.key, &destination_account.mint) {
        return Err(TokenError::MintMismatch.into());  // å¿…é¡»æ˜¯åŒä¸€ç§ä»£å¸
    }

    // â‘¡ è¯»å– Mint å¹¶éªŒè¯æƒé™
    let mut mint = Mint::unpack(&mint_info.data.borrow())?;
    
    match mint.mint_authority {
        COption::Some(mint_authority) => {
            // éªŒè¯ç­¾åè€…æ˜¯å¦æ˜¯ mint_authority
            Self::validate_owner(program_id, &mint_authority, owner_info, ...)?;
        },
        COption::None => {
            return Err(TokenError::FixedSupply.into());  // å›ºå®šä¾›åº”é‡ï¼Œä¸èƒ½é“¸å¸
        }
    }

    // â‘¢ æ ¸å¿ƒæ“ä½œï¼šåŒæ—¶å¢åŠ ä¸¤ä¸ªå€¼
    destination_account.amount = destination_account.amount
        .checked_add(amount)
        .ok_or(TokenError::Overflow)?;

    mint.supply = mint.supply
        .checked_add(amount)
        .ok_or(TokenError::Overflow)?;

    // â‘£ å†™å›ä¸¤ä¸ªè´¦æˆ·
    Account::pack(destination_account, &mut destination_account_info.data.borrow_mut())?;
    Mint::pack(mint, &mut mint_info.data.borrow_mut())?;

    Ok(())
}
```

**MintTo å‰åå¯¹æ¯”ï¼š**

```
Before:                           After (mint 1_000_000_000):

Mint Account                      Mint Account
  supply: 0        â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º       supply: 1B

Token Account                     Token Account
  amount: 0        â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º       amount: 1B

ğŸ“ å…³é”®ï¼šä¸¤ä¸ªå€¼åŒæ­¥å¢åŠ ï¼Œä¿è¯ sum(æ‰€æœ‰amount) == supply
```

### 6.5 ä¸ºä»€ä¹ˆåˆ†æˆ CreateAccount + InitializeMint ä¸¤æ­¥ï¼Ÿ

| åŸå›  | è¯´æ˜ |
|------|------|
| **æƒé™åˆ†ç¦»** | System Program ç®¡ç©ºé—´åˆ†é…ï¼ŒToken Program ç®¡ä¸šåŠ¡é€»è¾‘ |
| **çµæ´»æ€§** | å¯ä»¥ç”¨ä¸åŒæ–¹å¼åˆ›å»ºè´¦æˆ·ï¼ˆæ™®é€šè´¦æˆ·ã€PDA ç­‰ï¼‰ |
| **å®‰å…¨æ€§** | åˆ›å»ºæ—¶å°±é”å®š ownerï¼Œåªæœ‰ Token Program èƒ½ä¿®æ”¹æ•°æ® |

---

## é™„å½•

### A. å®Œæ•´æ•°æ®ç»“æ„ï¼ˆå¸¦å­—èŠ‚åç§»ï¼‰

<details>
<summary><b>Mint Account å†…å­˜å¸ƒå±€ (82 bytes)</b></summary>

<div style="overflow-x:auto">
<table>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Field</th>
      <th>Size</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td><code>mint_authority</code></td>
      <td>36 B</td>
      <td>[tag: 4B] + [pubkey: 32B]</td>
    </tr>
    <tr>
      <td>36</td>
      <td><code>supply</code></td>
      <td>8 B</td>
      <td>u64ï¼Œæ€»ä¾›åº”é‡</td>
    </tr>
    <tr>
      <td>44</td>
      <td><code>decimals</code></td>
      <td>1 B</td>
      <td>u8ï¼Œå°æ•°ä½æ•°</td>
    </tr>
    <tr>
      <td>45</td>
      <td><code>is_initialized</code></td>
      <td>1 B</td>
      <td>bool</td>
    </tr>
    <tr>
      <td>46</td>
      <td><code>freeze_authority</code></td>
      <td>36 B</td>
      <td>[tag: 4B] + [pubkey: 32B]</td>
    </tr>
  </tbody>
</table>
</div>

</details>

<details>
<summary><b>Token Account å†…å­˜å¸ƒå±€ (165 bytes)</b></summary>

<div style="overflow-x:auto">
<table>
  <thead>
    <tr>
      <th>Offset</th>
      <th>Field</th>
      <th>Size</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td><code>mint</code></td>
      <td>32 B</td>
      <td>Pubkey</td>
    </tr>
    <tr>
      <td>32</td>
      <td><code>owner</code></td>
      <td>32 B</td>
      <td>Pubkey</td>
    </tr>
    <tr>
      <td>64</td>
      <td><code>amount</code></td>
      <td>8 B</td>
      <td>u64</td>
    </tr>
    <tr>
      <td>72</td>
      <td><code>delegate</code></td>
      <td>36 B</td>
      <td>COption&lt;Pubkey&gt;</td>
    </tr>
    <tr>
      <td>108</td>
      <td><code>state</code></td>
      <td>1 B</td>
      <td>AccountState</td>
    </tr>
    <tr>
      <td>109</td>
      <td><code>is_native</code></td>
      <td>12 B</td>
      <td>COption&lt;u64&gt;</td>
    </tr>
    <tr>
      <td>121</td>
      <td><code>delegated_amount</code></td>
      <td>8 B</td>
      <td>u64</td>
    </tr>
    <tr>
      <td>129</td>
      <td><code>close_authority</code></td>
      <td>36 B</td>
      <td>COption&lt;Pubkey&gt;</td>
    </tr>
  </tbody>
</table>
</div>

</details>

### B. COption è®¾è®¡åŸç†

<details>
<summary><b>ä¸ºä»€ä¹ˆä¸ç”¨ Rust çš„ Optionï¼Ÿ</b></summary>

<p>Rust çš„ <code>Option&lt;T&gt;</code> å¤§å°ä¸å›ºå®šï¼Œè€Œé“¾ä¸Šè´¦æˆ·éœ€è¦ <b>å›ºå®šå¤§å°</b>ã€‚</p>

<p><code>COption</code> æ˜¯ C é£æ ¼çš„ Optionï¼Œç»“æ„å›ºå®šï¼š</p>

<pre><code>// COption&lt;Pubkey&gt; = 36 bytes
// â”œâ”€ tag:    4 bytes  (0 = None, 1 = Some)
// â””â”€ value: 32 bytes  (Pubkey)
//
// å†…å­˜è¡¨ç¤ºï¼š
// None:  [0, 0, 0, 0] + [32 bytes é›¶å€¼]
// Some:  [1, 0, 0, 0] + [32 bytes å®é™…å…¬é’¥]
</code></pre>

<p><b>ä¸ºä»€ä¹ˆ tag ç”¨ 4 å­—èŠ‚è€Œä¸æ˜¯ 1 å­—èŠ‚ï¼Ÿ</b></p>
<p>ä¸ºäº†å†…å­˜å¯¹é½ï¼Œ4 å­—èŠ‚è¾¹ç•Œå¯¹é½å¯ä»¥ï¼š</p>
<ul>
  <li>æé«˜ CPU è¯»å–æ•ˆç‡</li>
  <li>ä¿è¯è·¨è¯­è¨€ï¼ˆCã€Rustã€JSï¼‰å…¼å®¹</li>
</ul>
</details>

### C. æ ¸å¿ƒç¨‹åºåœ°å€

```
SPL Token Program:      TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
Associated Token:       ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL
Token Metadata:         metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s
Native SOL Mint:        So11111111111111111111111111111111111111112
```

---

## æ€»ç»“å¯¹ç…§è¡¨

| ç»´åº¦ | Mint | Token Accountï¼ˆataï¼‰| Metadata |
|------|------|---------------|----------|
| **ç±»æ¯”** | å°é’å‚æ¨¡æ¿ | é“¶è¡Œè´¦æˆ· | å•†å“æ ‡ç­¾ |
| **å›ç­”çš„é—®é¢˜** | è¿™æ˜¯ä»€ä¹ˆå¸ï¼Ÿ | ä½ æœ‰å¤šå°‘ï¼Ÿ | å®ƒå«ä»€ä¹ˆï¼Ÿ |
| **å¤§å°** | 82 B | 165 B | å¤§å°å¯å˜ï¼ˆä¸ name/symbol/uri/creators ç­‰ç›¸å…³ï¼‰ |
| **æ¯ç§ä»£å¸** | 1 ä¸ª | N ä¸ªï¼ˆæ¯äºº 1 ä¸ªï¼‰ | 1 ä¸ª |
| **ç®¡ç†ç¨‹åº** | SPL Token | SPL Token | Metaplex |
| **åœ°å€ç±»å‹** | éšæœº | éšæœºæˆ– PDA (ATA) | PDA |

---

